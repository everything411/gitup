.\" Copyright (c) 2012-2022, John Mehr <jmehr@umn.edu>
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\" $FreeBSD$
.\"
.Dd October 7, 2023
.Dt GITUP(1)
.Os
.Sh NAME
.Nm gitup
.Nd A minimalist, dependency-free program to clone/pull Git repositories.
.Sh SYNOPSIS
.Nm
.Cm section
.Op Fl cklrSV
.Op Fl C Ar configuration file
.Op Fl d Ar display depth
.Op Fl h Ar commit checksum
.Op Fl I Ar ignore paths that contain this string
.Op Fl p Ar target path
.Op Fl t Ar tag
.Op Fl u Ar pack file
.Op Fl v Ar verbosity
.Op Fl w Ar commit checksum
.Sh DESCRIPTION
.Nm
is a minimalist, dependency-free program used to clone or synchronize a local
copy of a Git repository.
It is not intended to be a full-featured replacement for the devel/git port,
but rather, is intended to provide a convenient way for users to update FreeBSD
source files without having to install devel/git (and all of its related
dependencies) and without the substantial disk overhead that normally accompany
local Git repositories.
.Pp
.Nm
currently only supports anonymous, encrypted transfers via the "Smart HTTP"
protocol over HTTPS.
.Sh OPTIONS
Configuration options are stored in %%CONFIG_FILE_PATH%% and are grouped
into commonly used sections (additional custom sections can be added to this
file).
The following command line options can be used to override the default and/or
section values:
.Bl -tag -width Fl
.It Fl C
The location of the configuration file to use.
.It Fl c
Force
.Nm
to clone the repository.
.It Fl d
Limit the display of updated files to the specified number of directories deep.
(0 = display the full path of each file).
.It Fl h
The "have" commit checksum of the repository to use.
Only needed when importing a pack file generated by the official Git client.
.It Fl I
Ignore paths that contain this string.  Regular expressions are supported.
.It Fl k
Save a copy of the pack data.
.It Fl l
Low memory mode -- temporarily stores uncompressed object data to disk instead
of memory.
.It Fl p
Path to an alternative local repository (override the `target_directory` that is
specified in gitup.conf(5)).  The SHA1 checksum of the new absolute target path
is appended to the known paths filename in /var/db/gitup allowing multiple
independent copies of the repository to exist.
.It Fl r
Repair the local repository, replacing any files that are missing or have been
modified.
.It Fl S
Specify the source IP address on the local machine to use.
.It Fl t
Fetch the commit referenced by the specified tag.
.It Fl u
Skip the download of the pack data and use the specified file instead.
.It Fl v
How verbose the output should be (0 = no output, 1 = show only names of the
updated files, 2 = also show all files that are being ignored, 3 = also show
commands sent to the server and additional debugging information).
.It Fl V
Display the version number and exit.
.It Fl w
The "want" commit checksum of the repository to retrieve.
.Pp
.Sh FILES
.Bl -tag -width "%%CONFIG_FILE_PATH%%"
.It %%CONFIG_FILE_PATH%%
Default location of the
.Nm
configuration file.
.It /var/db/gitup
Default location where
.Nm
stores its lists of known files.
The files stored here are used during subsequent runs to reconstruct the local
repository state and confirm that the local tree is intact.
.Pp
.Sh ENVIRONMENT
Proxy server host, port, username and password values can be entered in
"%%CONFIG_FILE_PATH%%" or can be specified in the
.Pa https_proxy
environment variable:
.Pp
.Bd
.Dl https://server:port/
.Dl https://username:password@server:port/
.Ed
.Sh CAVEATS
Because
.Nm
neither uses nor updates the .git directory, it is not a drop-in replacement for
the official Git client.
.Nm
should only be used on repositories originally cloned with the official Git
client if there is no intention to ever use the official Git client on that
local repository again.
.Pp
To keep its footprint as small as possible,
.Nm
does not retain pack files downloaded from the repository (unless explicitly
instructed to do so) and does not use a saved pack file (unless explicitly
instructed to do so).
.Nm
relies on the known remote files lists stored in /var/db/gitup and the current
state of the local repository to reconstruct data that would normally be stored
in the pack file.
Discrepancies in the local repository will be flagged as errors and
.Nm
will attempt to any restore any missing or modified files from the server,
returning the local repository to a clean state.
.Pp
Extra care should be given when specifying a commit to pull as
.Nm
only performs shallow clones and does not have access to a repository's full
commit history.  If a commit is passed in via the
.Pa -w
command line argument and that commit exists on a different branch, the Git
server will neither object nor inform
.Nm
of the branch change and will send a pack file that will convert the local
repository.  If the change of branches is intentional, the relevant section in
%%CONFIG_FILE_PATH%% will need to be manually updated.
.Sh EXAMPLES
Using the configuration options for commonly used repositories/branches stored
in %%CONFIG_FILE_PATH%%, to clone/pull a copy of the most recent revision
of stable/12:
.Pp
.Dl "gitup stable"
.Pp
To retrieve a copy of freebsd-ports at
commit 0123456789abcdef0123456789abcdef01234567:
.Pp
.Dl "gitup ports -w 0123456789abcdef0123456789abcdef01234567"
.Sh EXIT STATUS
.Nm
returns EXIT_SUCCESS upon successful operation, returns 2 if a repair has
occurred and returns EXIT_FAILURE upon any unsuccessful operation.
.Sh SEE ALSO
.Xr gitup.conf 5
.Sh AUTHORS
John Mehr <jmehr@umn.edu> is the author of
.Nm
and this man page.
